<!DOCTYPE HTML>
<html lang="en-US" manifest="../../manifest.appcache">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>posts 컨트롤러 변경 | 초보자를 위한 레일스 가이드북</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="RORLabGitBook">
        <meta name="description" content="The Guideline Book for Rails Startups">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        <link rel="next" href="../../contents/walkthrough/posts_view_file.html" />
        
        
        <link rel="prev" href="../../contents/walkthrough/top_menu.html" />
        

        <meta property="og:title" content="posts 컨트롤러 변경 | 초보자를 위한 레일스 가이드북">
        <meta property="og:site_name" content="초보자를 위한 레일스 가이드북">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/RORLabGitBook">
        <meta property="book:tag" content="GitBook">

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">
        
    </head>
    <body>
        

        <link rel="stylesheet" href="../../gitbook/style.css">
        


        
    <div class="book" data-github="RORLabGitBook/guideline" data-level="4.9" data-basepath="../.." data-revision="1399885157270">
    <div class="book-header">
    <!-- Actions Left -->
    
    <a href="https://github.com/RORLabGitBook/guideline" target="_blank" class="btn pull-left"><i class="fa fa-bookmark-o"></i></a>
    
    <a href="#" class="btn pull-left toggle-summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search"><i class="fa fa-search"></i></a>
    <span id="font-settings-wrapper">
        <a href="#" class="btn pull-left toggle-font-settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
	<div class="dropdown-caret">
  <span class="caret-outer"></span>
  <span class="caret-inner"></span>
</div>

	<div class="btn-group btn-block">
		<button id="reduce-font-size" class="btn btn-default">A</button>
		<button id="enlarge-font-size" class="btn btn-default">A</button>
	</div>

	<ul class="list-group font-family-list">
		<li class="list-group-item" data-font="0">Serif</li>
		<li class="list-group-item" data-font="1">Sans</li>
	</ul>

	<div class="btn-group btn-group-xs btn-block color-theme-list">
	  <button type="button" class="btn btn-default" id="color-theme-preview-0" data-theme="0">White</button>
	  <button type="button" class="btn btn-default" id="color-theme-preview-1" data-theme="1">Sepia</button>
	  <button type="button" class="btn btn-default" id="color-theme-preview-2" data-theme="2">Night</button>
	</div>
</div>

    </span>

    <!-- Actions Right -->
    
    <a href="#" target="_blank" class="btn pull-right" data-sharing="google-plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right" data-sharing="facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right" data-sharing="twitter"><i class="fa fa-twitter"></i></a>
    

    
    <a href="https://github.com/RORLabGitBook/guideline/stargazers" target="_blank" class="btn pull-right count-star hidden-xs"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/RORLabGitBook/guideline/watchers" target="_blank" class="btn pull-right count-watch hidden-xs"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>
    

    <!-- Title -->
    <h1>
        <i class="fa fa-spinner fa-spin"></i>
        <a href="../../" >초보자를 위한 레일스 가이드북</a>
    </h1>
</div>

    <div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        
        <li>
            <a href="https://github.com/RORLabGitBook" target="blank">About the author</a>
        </li>
        

        
        <li>
            <a href="https://github.com/RORLabGitBook/guideline/issues" target="blank">Questions and Issues</a>
        </li>
        

        
        <li>
            <a href="https://github.com/RORLabGitBook/guideline/edit/master/contents/walkthrough/posts_controller_modified.md" target="blank">Edit and Contribute</a>
        </li>
        

        
        <li class="divider"></li>
        

        <li data-level="0" data-path="index.html">
            <a href="../../"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li  data-level="1" data-path="contents/authors.html">
                
                <a href="../../contents/authors.html">
                    <i class="fa fa-check"></i> <b>1.</b> 저자소개
                </a>
                
                
            </li>
        
            <li  data-level="2" data-path="contents/rubyonrails_intro.html">
                
                <a href="../../contents/rubyonrails_intro.html">
                    <i class="fa fa-check"></i> <b>2.</b> 루비온레일스 소개
                </a>
                
                
            </li>
        
            <li  data-level="3" data-path="contents/environments.html">
                
                <a href="../../contents/environments.html">
                    <i class="fa fa-check"></i> <b>3.</b> 환경 준비
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="3.1" data-path="contents/dev_env.html">
                            
                            <a href="../../contents/dev_env.html">
                                <i class="fa fa-check"></i> <b>3.1.</b> 개발환경
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.2" data-path="contents/rbenv.html">
                            
                            <a href="../../contents/rbenv.html">
                                <i class="fa fa-check"></i> <b>3.2.</b> rbenv 설치
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.3" data-path="contents/git.html">
                            
                            <a href="../../contents/git.html">
                                <i class="fa fa-check"></i> <b>3.3.</b> Git 설치
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.4" data-path="contents/railsinstall.html">
                            
                            <a href="../../contents/railsinstall.html">
                                <i class="fa fa-check"></i> <b>3.4.</b> 레일스 설치
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.5" data-path="contents/pro_env.html">
                            
                            <a href="../../contents/pro_env.html">
                                <i class="fa fa-check"></i> <b>3.5.</b> 운영환경
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="4" data-path="contents/walkthrough/start.html">
                
                <a href="../../contents/walkthrough/start.html">
                    <i class="fa fa-check"></i> <b>4.</b> 프로젝트 따라하기
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="4.1" data-path="contents/walkthrough/gemfile.html">
                            
                            <a href="../../contents/walkthrough/gemfile.html">
                                <i class="fa fa-check"></i> <b>4.1.</b> Gemfile의 작성
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.2" data-path="contents/walkthrough/welcome_controller.html">
                            
                            <a href="../../contents/walkthrough/welcome_controller.html">
                                <i class="fa fa-check"></i> <b>4.2.</b> welcome 컨트롤러의 생성
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.3" data-path="contents/walkthrough/first_model.html">
                            
                            <a href="../../contents/walkthrough/first_model.html">
                                <i class="fa fa-check"></i> <b>4.3.</b> 첫번째 모델의 생성
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.4" data-path="contents/walkthrough/layout.html">
                            
                            <a href="../../contents/walkthrough/layout.html">
                                <i class="fa fa-check"></i> <b>4.4.</b> 어플리케이션 레이아웃의 작성
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.5" data-path="contents/walkthrough/posts_CRUD.html">
                            
                            <a href="../../contents/walkthrough/posts_CRUD.html">
                                <i class="fa fa-check"></i> <b>4.5.</b> posts CRUD 살펴보기
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.6" data-path="contents/walkthrough/bulletin.html">
                            
                            <a href="../../contents/walkthrough/bulletin.html">
                                <i class="fa fa-check"></i> <b>4.6.</b> Bulletin 모델의 생성
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.7" data-path="contents/walkthrough/model_association.html">
                            
                            <a href="../../contents/walkthrough/model_association.html">
                                <i class="fa fa-check"></i> <b>4.7.</b> 모델 관계선언
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.8" data-path="contents/walkthrough/top_menu.html">
                            
                            <a href="../../contents/walkthrough/top_menu.html">
                                <i class="fa fa-check"></i> <b>4.8.</b> friendly_id 젬 사용하기
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.9" data-path="contents/walkthrough/posts_controller_modified.html">
                            
                            <a href="../../contents/walkthrough/posts_controller_modified.html">
                                <i class="fa fa-check"></i> <b>4.9.</b> posts 컨트롤러 변경
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.10" data-path="contents/walkthrough/posts_view_file.html">
                            
                            <a href="../../contents/walkthrough/posts_view_file.html">
                                <i class="fa fa-check"></i> <b>4.10.</b> posts 뷰 변경
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.11" data-path="contents/walkthrough/bulletin_type.html">
                            
                            <a href="../../contents/walkthrough/bulletin_type.html">
                                <i class="fa fa-check"></i> <b>4.11.</b> 게시판 레이아웃 작성하기
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="5" data-path="deployment/first.html">
                
                <a href="../../deployment/first.html">
                    <i class="fa fa-check"></i> <b>5.</b> 프로젝트 배포하기
                </a>
                
                
            </li>
        
            <li  data-level="6" data-path="appendices/appendix.html">
                
                <a href="../../appendices/appendix.html">
                    <i class="fa fa-check"></i> <b>6.</b> 부록
                </a>
                
                
            </li>
        

        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank">Generated using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="page-wrapper" tabindex="-1">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 90.9090909090909%;min-width: 86.36363636363636%;"></div>
    </div>
    <div class="chapters">
    
        <a href="../../index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="../../contents/authors.html" title="저자소개" class="chapter done new-chapter" data-progress="1" style="left: 4.545454545454546%;"></a>
    
        <a href="../../contents/rubyonrails_intro.html" title="루비온레일스 소개" class="chapter done new-chapter" data-progress="2" style="left: 9.090909090909092%;"></a>
    
        <a href="../../contents/environments.html" title="환경 준비" class="chapter done new-chapter" data-progress="3" style="left: 13.636363636363637%;"></a>
    
        <a href="../../contents/dev_env.html" title="개발환경" class="chapter done " data-progress="3.1" style="left: 18.181818181818183%;"></a>
    
        <a href="../../contents/rbenv.html" title="rbenv 설치" class="chapter done " data-progress="3.2" style="left: 22.727272727272727%;"></a>
    
        <a href="../../contents/git.html" title="Git 설치" class="chapter done " data-progress="3.3" style="left: 27.272727272727273%;"></a>
    
        <a href="../../contents/railsinstall.html" title="레일스 설치" class="chapter done " data-progress="3.4" style="left: 31.818181818181817%;"></a>
    
        <a href="../../contents/pro_env.html" title="운영환경" class="chapter done " data-progress="3.5" style="left: 36.36363636363637%;"></a>
    
        <a href="../../contents/walkthrough/start.html" title="프로젝트 따라하기" class="chapter done new-chapter" data-progress="4" style="left: 40.90909090909091%;"></a>
    
        <a href="../../contents/walkthrough/gemfile.html" title="Gemfile의 작성" class="chapter done " data-progress="4.1" style="left: 45.45454545454545%;"></a>
    
        <a href="../../contents/walkthrough/posts_view_file.html" title="posts 뷰 변경" class="chapter done " data-progress="4.10" style="left: 50%;"></a>
    
        <a href="../../contents/walkthrough/bulletin_type.html" title="게시판 레이아웃 작성하기" class="chapter done " data-progress="4.11" style="left: 54.54545454545455%;"></a>
    
        <a href="../../contents/walkthrough/welcome_controller.html" title="welcome 컨트롤러의 생성" class="chapter done " data-progress="4.2" style="left: 59.09090909090909%;"></a>
    
        <a href="../../contents/walkthrough/first_model.html" title="첫번째 모델의 생성" class="chapter done " data-progress="4.3" style="left: 63.63636363636363%;"></a>
    
        <a href="../../contents/walkthrough/layout.html" title="어플리케이션 레이아웃의 작성" class="chapter done " data-progress="4.4" style="left: 68.18181818181819%;"></a>
    
        <a href="../../contents/walkthrough/posts_CRUD.html" title="posts CRUD 살펴보기" class="chapter done " data-progress="4.5" style="left: 72.72727272727273%;"></a>
    
        <a href="../../contents/walkthrough/bulletin.html" title="Bulletin 모델의 생성" class="chapter done " data-progress="4.6" style="left: 77.27272727272727%;"></a>
    
        <a href="../../contents/walkthrough/model_association.html" title="모델 관계선언" class="chapter done " data-progress="4.7" style="left: 81.81818181818181%;"></a>
    
        <a href="../../contents/walkthrough/top_menu.html" title="friendly_id 젬 사용하기" class="chapter done " data-progress="4.8" style="left: 86.36363636363636%;"></a>
    
        <a href="../../contents/walkthrough/posts_controller_modified.html" title="posts 컨트롤러 변경" class="chapter done " data-progress="4.9" style="left: 90.9090909090909%;"></a>
    
        <a href="../../deployment/first.html" title="프로젝트 배포하기" class="chapter  new-chapter" data-progress="5" style="left: 95.45454545454545%;"></a>
    
        <a href="../../appendices/appendix.html" title="부록" class="chapter  new-chapter" data-progress="6" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_20">
                    
                        <h1 id="posts-">posts 컨트롤러 변경</h1>
<h2 id="-">중첩 라우팅</h2>
<p>RESTful URI로부터 <code>bulletin_id</code> 또는 <code>post</code>의 <code>id</code> 값을 받아 해당 <code>bulletin</code> 객체를 생성하거나 이 <code>bulletin</code> 객체의 <code>posts</code> 개체를 불러오기 위해서는 <code>중첩 라우팅</code>(nested routing) 기법을 사용하면 편리하다.</p>
<p><code>config/routes.rb</code> 파일을 열어 아래와 같이 수정한다.</p>
<pre><code>Rails.application.routes.draw do
  resources :bulletins do
    resources :posts
  end

  root &#39;welcome#index&#39;
end
</code></pre><p>위와 같이 리소스 라우트를 중첩하면 아래와 같은 라우팅을 사용할 수 있게 된다. 이것을 콘솔에서 확인해 보자.</p>
<pre><code>$ bin/rake routes
            Prefix Verb   URI Pattern                                      Controller#Action
    bulletin_posts GET    /bulletins/:bulletin_id/posts(.:format)          posts#index
                   POST   /bulletins/:bulletin_id/posts(.:format)          posts#create
 new_bulletin_post GET    /bulletins/:bulletin_id/posts/new(.:format)      posts#new
edit_bulletin_post GET    /bulletins/:bulletin_id/posts/:id/edit(.:format) posts#edit
     bulletin_post GET    /bulletins/:bulletin_id/posts/:id(.:format)      posts#show
                   PATCH  /bulletins/:bulletin_id/posts/:id(.:format)      posts#update
                   PUT    /bulletins/:bulletin_id/posts/:id(.:format)      posts#update
                   DELETE /bulletins/:bulletin_id/posts/:id(.:format)      posts#destroy
         bulletins GET    /bulletins(.:format)                             bulletins#index
                   POST   /bulletins(.:format)                             bulletins#create
      new_bulletin GET    /bulletins/new(.:format)                         bulletins#new
     edit_bulletin GET    /bulletins/:id/edit(.:format)                    bulletins#edit
          bulletin GET    /bulletins/:id(.:format)                         bulletins#show
                   PATCH  /bulletins/:id(.:format)                         bulletins#update
                   PUT    /bulletins/:id(.:format)                         bulletins#update
                   DELETE /bulletins/:id(.:format)                         bulletins#destroy
              root GET    /                                                welcome#index
</code></pre><p>위와 같은 라우팅 테이블에서 <code>URI Pattern</code>을 주목하자. 외부로부터 들어오는 요청이 이 테이블의 <code>URI Pattern</code>과 일치할 경우 매핑되는 컨트롤러의 액션이 호출된다. 이 때 <code>URI Pattern</code> 중 심볼에 매칭되는 부분은 <code>params[]</code> 해쉬의 키로 사용되어 해당 파라미터의 값을 불러올 수 있게 된다. 위의 예에서는 <code>params[:bulletin_id]</code> 키에 해당하는 파라미터 값을 불러와 액션에서 사용할 수 있게 된다.</p>
<p>특정 게시판의 게시물 목록을 불러오는 예를 들어 보자.</p>
<pre><code>Prefix : bulletin_posts
Verb : GET
URI Pattern : /bulletins/:bulletin_id/posts(.:format)
Controller#Action : posts#index
</code></pre><p><code>Prefix</code> 끝에 <code>_path</code> 또는 <code>_url</code>을 붙여 헬퍼메소드로 사용할 수 있는데, 뷰 템플릿에서 동적 URL을 사용할 수 있도록 해 주어 정적 URL을 일일이 입력할 필요가 없게 된다. 즉, 뷰 템플릿 파일에서 <code>&lt;%= bulletin_posts_path(&#39;공지사항&#39;) %&gt;</code>와 같이 사용하면 뷰 파일이 렌더링될 때 <code>http://localhost:3000/bulletins/공지사항/posts</code>으로 변환된다.</p>
<p>또한 이 <code>URI Pattern</code>에 매핑되는 해당 컨트롤러의 액션에서는 <code>params[:bulletin_id]</code> 해시키를 이용하여 <code>&#39;공지사항&#39;</code> 값을 얻을 수 있게 된다.</p>
<h2 id="posts-">posts 컨트롤러의 변경</h2>
<p><code>Controller#Action</code>의 <code>posts#index</code>는 <code>posts</code> 컨트롤러의 <code>index</code> 액션을 호출하라는 의미이다. 여기서는  <code>app/controllers/posts_controller.rb</code> 파일의 <code>index</code> 액션 코드만을 주목하자.</p>
<pre><code>class PostsController &lt; ApplicationController

  before_action :set_bulletin
  before_action :set_post, only: [:show, :edit, :update, :destroy]


  # GET /posts
  # GET /posts.json
  def index
    @posts = @bulletin.posts.all
  end

...중략~

  private
    def set_bulletin
      @bulletin = Bulletin.friendly.find(params[:bulletin_id])
    end

    def set_post
      @post = @bulletin.posts.find(params[:id])
    end

    def post_params
      params.require(:post).permit(:title, :content)
    end
end
</code></pre><p><code>index</code> 액션의 인스턴스 변수 <code>@bulletin</code>는, 액션 실행전에 수행되는 <code>set_bulletin</code> 메소드의 결과로 만들어진다. 이 <code>private</code>  메소드는 <code>posts</code> 컨트롤러의 모든 액션이 실행되기 전에 수행된다. 반면에, <code>before_action</code>인 <code>set_post</code> 메소드는 <code>:show</code> <code>:edit</code>, <code>:update</code>, <code>:destroy</code> 액션이 실행되기 전에만 수행된다(<code>before_action</code> 매크로의 <code>:only</code> 옵션으로 지정함). 따라서 <code>index</code> 액션이 실행될 때는 <code>set_posts</code> 메소드가 사전에 실행되지 않게 된다. <code>index</code> 액션에서는 궁극적으로 인스턴스 변수 <code>@posts</code>를 생성하게 되고 이것은 해당 뷰 템플릿(<code>app/views/posts/index.html.erb</code>)에서 바로 사용할 수 있게 된다.</p>

                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="../../contents/walkthrough/top_menu.html" class="navigation navigation-prev "><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../../contents/walkthrough/posts_view_file.html" class="navigation navigation-next "><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        

        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="../../gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="../../gitbook/app.js"></script>
        

    
    <script src="../../gitbook/plugins/gitbook-plugin-disqus/plugin.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-ga/plugin.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-mixpanel/plugin.js"></script>
    

    
    <script src="http://cdn.mathjax.org/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"disqus":{"shortName":"railsguideline"},"ga":{"token":"UA-30294363-3"}};
    gitbook.start(config);
});
</script>

    </body>
</html>
